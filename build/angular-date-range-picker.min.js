/*! angular-date-range-picker 2014-08-22 */
(function(){angular.module("dateRangePicker",["pasvaz.bindonce"]),angular.module("dateRangePicker").directive("dateRangePicker",["$compile","$timeout",function(a,b){var c,d;return d='<div ng-show="visible" class="angular-date-range-picker__picker" ng-click="handlePickerClick($event)" ng-class="{\'angular-date-range-picker--ranged\': showRanged }">\n  <div class="angular-date-range-picker__timesheet">\n    <a ng-click="move(-1, $event)" class="angular-date-range-picker__prev-month">&#9664;</a>\n    <div bindonce ng-repeat="month in months" class="angular-date-range-picker__month">\n      <div class="angular-date-range-picker__month-name" bo-text="month.name"></div>\n      <table class="angular-date-range-picker__calendar">\n        <tr>\n          <th bindonce ng-repeat="day in month.weeks[1]" class="angular-date-range-picker__calendar-weekday" bo-text="day.date.format(\'dd\')">\n          </th>\n        </tr>\n        <tr bindonce ng-repeat="week in month.weeks">\n          <td\n              bo-class=\'{\n                "angular-date-range-picker__calendar-day": day,\n                "angular-date-range-picker__calendar-day-selected-0": day.selected[0],\n                "angular-date-range-picker__calendar-day-selected-1": day.selected[1],\n                "angular-date-range-picker__calendar-day-disabled": day.disabled,\n                "angular-date-range-picker__calendar-day-start": day.start\n              }\'\n              ng-repeat="day in week track by $index" ng-click="select(day, $event)">\n              <div class="angular-date-range-picker__calendar-day-wrapper" bo-text="day.date.date()"></div>\n          </td>\n        </tr>\n      </table>\n    </div>\n    <a ng-click="move(+1, $event)" class="angular-date-range-picker__next-month">&#9654;</a>\n  </div>\n  <div class="angular-date-range-picker__panel">\n    <div ng-show="showRanged">\n      Select range: <select ng-click="prevent_select($event)" ng-model="quick" ng-options="e.range as e.label for e in quickList"></select>\n    </div>\n    <input type="checkbox" value="1" ng-model="cursel_pre" ng-true-value="1" ng-false-value="0"/> Compare to...\n    <div class="angular-date-range-picker__buttons">\n      <a ng-click="ok($event)" class="angular-date-range-picker__apply">Apply</a>\n      <a ng-click="hide($event)" class="angular-date-range-picker__cancel">cancel</a>\n    </div>\n  </div>\n</div>',c="CUSTOM",{restrict:"AE",replace:!0,template:'<span tabindex="0" ng-keydown="hide()" class="angular-date-range-picker__input">\n  <span ng-if="showRanged">\n    <span ng-show="!!model">{{ model[0].start.format("ll") }} - {{ model[0].end.format("ll") }}</span>\n    <span ng-hide="!!model">Select date range</span>\n  </span>\n  <span ng-if="!showRanged">\n    <span ng-show="!!model">{{ model[0].format("ll") }}</span>\n    <span ng-hide="!!model">Select date</span>\n  </span>\n</span>',scope:{model:"=ngModel",customSelectOptions:"=",ranged:"=",pastDates:"@",callback:"&"},link:function(e,f){var g,h,i,j,k,l,m;return e.quickListDefinitions=e.customSelectOptions,null==e.quickListDefinitions&&(e.quickListDefinitions=[{label:"This week",range:moment().range(moment().startOf("week").startOf("day"),moment().endOf("week").startOf("day"))},{label:"Next week",range:moment().range(moment().startOf("week").add(1,"week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This fortnight",range:moment().range(moment().startOf("week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This month",range:moment().range(moment().startOf("month").startOf("day"),moment().endOf("month").startOf("day"))},{label:"Next month",range:moment().range(moment().startOf("month").add(1,"month").startOf("day"),moment().add(1,"month").endOf("month").startOf("day"))}]),e.quick=null,e.range=null,e.selecting=!1,e.visible=!1,e.start=[null,null],e.cursel=0,e.selection=[],e.showRanged=void 0===e.ranged?!0:e.ranged,e.showCompare=void 0===e.compare?!0:e.compare,e.$watch("cursel_pre",function(a,b,c){return c.cursel=a?parseInt(a):0}),k=function(a){return null==a&&(a=0),e.showCompare?(e.model||(e.model=[]),e.model[a]):e.model},l=function(a){var b,d,f,g,h;if(null==a&&(a=!1),e.showRanged){for(e.quickList=[],a&&e.quickList.push({label:"Custom",range:c}),g=e.quickListDefinitions,h=[],d=0,f=g.length;f>d;d++)b=g[d],h.push(e.quickList.push(b));return h}},i=function(){var a,b,c;return e.showRanged?e.range=e.selection[e.cursel]?(c=e.selection[e.cursel].start.clone().startOf("month").startOf("day"),a=c.clone().add(2,"months").endOf("month").startOf("day"),moment().range(c,a)):moment().range(moment().startOf("month").subtract(1,"month").startOf("day"),moment().endOf("month").add(1,"month").startOf("day")):(b=k(e.cursel),e.selection[e.cursel]=!1,e.selection[e.cursel]=b||!1,e.date=moment(b)||moment(),e.range=moment().range(moment(e.date).startOf("month"),moment(e.date).endOf("month")))},j=function(){var a,b,d,f;if(e.showRanged&&e.selection[e.cursel]){for(f=e.quickList,b=0,d=f.length;d>b;b++)if(a=f[b],a.range!==c&&e.selection[e.cursel].start.startOf("day").unix()===a.range.start.startOf("day").unix()&&e.selection[e.cursel].end.startOf("day").unix()===a.range.end.startOf("day").unix())return e.quick=a.range,void l();return e.quick=c,l(!0)}},m=function(){var a,b,c,d,f,g;for(e.months=[],c=12*e.range.start.year()+e.range.start.month(),b=moment().startOf("week").day(),e.range.by("days",function(a){var d,f,g,h,i,j,k,l,m,n;d=a.day()-b,0>d&&(d=7+d),h=12*a.year()+a.month()-c,k=parseInt((7+a.date()-d)/7),i=[],f=!1,n=e.start;for(g in n)j=n[g],e.showRanged?j?(i[g]=a===j,e.cursel===g&&(f=j>a)):i[g]=e.selection[g]&&e.selection[g].contains(a):(i[g]=a.isSame(e.selection[g]),e.pastDates&&(f=moment().diff(a,"days")>0));return(l=e.months)[h]||(l[h]={name:a.format("MMMM YYYY"),weeks:[]}),(m=e.months[h].weeks)[k]||(m[k]=[]),e.months[h].weeks[k][d]={date:a,selected:i,disabled:f,start:e.start[e.cursel]&&e.start[e.cursel].unix()===a.unix()}}),g=e.months,d=0,f=g.length;f>d;d++)a=g[d],a.weeks[0]||a.weeks.splice(0,1);return j()},e.show=function(){var a,b;for(a=b=0;1>=b;a=++b)e.selection[a]=k(a);return i(),m(),e.visible=!0},e.hide=function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.visible=!1,e.start=[null,null]},e.prevent_select=function(a){return null!=a&&"function"==typeof a.stopPropagation?a.stopPropagation():void 0},e.ok=function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.model=e.model||[],e.model[0]=e.selection[0],e.model[1]=e.selection[1],b(function(){return e.callback?e.callback():void 0}),e.hide()},e.select=function(a,b){return null!=b&&"function"==typeof b.stopPropagation&&b.stopPropagation(),a.disabled?void 0:(e.showRanged?(e.selecting=!e.selecting,e.selecting?e.start[e.cursel]=a.date:(e.selection[e.cursel]=moment().range(e.start[e.cursel],a.date),e.start[e.cursel]=null)):e.selection[e.cursel]=moment(a.date),m())},e.move=function(a,b){return null!=b&&"function"==typeof b.stopPropagation&&b.stopPropagation(),e.showRanged?e.range=moment().range(e.range.start.add(a,"months").startOf("month").startOf("day"),e.range.start.clone().add(2,"months").endOf("month").startOf("day")):(e.date.add(a,"months"),e.range=moment().range(moment(e.date).startOf("month"),moment(e.date).endOf("month"))),m()},e.handlePickerClick=function(a){return null!=a&&"function"==typeof a.stopPropagation?a.stopPropagation():void 0},e.$watch("quick",function(a){return a&&a!==c?(e.selection[e.cursel]=e.quick,e.selecting=!1,e.start[e.cursel]=null,i(),m()):void 0}),e.$watch("customSelectOptions",function(a){return"undefined"!=typeof customSelectOptions&&null!==customSelectOptions?e.quickListDefinitions=a:void 0}),h=a(angular.element(d))(e),f.append(h),f.bind("click",function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.$apply(function(){return e.visible?e.hide():e.show()})}),g=function(){return e.$apply(function(){return e.hide()}),!0},angular.element(document).bind("click",g),e.$on("$destroy",function(){return angular.element(document).unbind("click",g)}),l(),i(),m()}}}])}).call(this);